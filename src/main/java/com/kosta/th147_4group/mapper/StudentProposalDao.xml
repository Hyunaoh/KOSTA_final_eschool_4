<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- namespace="dao.NoticeDao 인터페이스 동일 경로 구현된되는 ID 값들을 인터페이스 함수명과 동일 -->
<mapper namespace="sqlSession">


	<!-- 건의사항 모든 데이터 받아오기 -->
	<select id="getAllStudentProposal" resultType="com.kosta.th147_4group.vo.StudentProposalVO">
		SELECT * FROM STUDENTPROPOSAL
	</select>
	
	<!-- 특정 컬럼의 모든 데이터 받아오기 -->
	<select id="getStudentProposal" parameterType="String" resultType="com.kosta.th147_4group.vo.StudentProposalVO">
		SELECT * FROM STUDENTPROPOSAL WHERE stGrade=#{stGrade} 
	</select>
	
	<!-- 특정 컬럼 삭제하기 -->
	<delete id="deleteStudentProposal" parameterType="int">
		DELETE STUDENTPROPOSAL WHERE stNum=#{stNum}
	</delete>

	<!-- 페이지 넘버 받아오기 -->
	<select id="getNowPage" parameterType="java.util.HashMap" resultType="com.kosta.th147_4group.vo.StudentProposalVO" >
		SELECT st.rownum as stNum, st.stGrade as stGrade, st.stSchoolClass as stSchoolClass, st.stTitle as stTitle,
        st.stMessage as stMessage, st.stDate as stDate, st.stWriter as stWriter, st.stCategoly as stCategoly, st.stHit as stHit 
		FROM 
		(
		SELECT @rownum := @rownum + 1 AS rownum, STUDENTPROPOSAL.*
		FROM
		STUDENTPROPOSAL, (SELECT @rownum :=0) n
		ORDER BY rownum ASC
		) st
		WHERE st.rownum BETWEEN #{num1} AND #{num2} 
		ORDER BY rownum ASC
	</select>
	
	<!-- 글 등록 -->
	<insert id="insert">
     <!-- int insert( Notice n ) 
        INSERT INTO TNOTICES(SEQ, TITLE, CONTENT, WRITER, REGDATE, HIT, FILESRC , FILESRC2)
        VALUES( (SELECT MAX(TO_NUMBER(SEQ))+1 FROM TNOTICES), :title, :content, :writer, SYSDATE, 0, :fileSrc , :fileSrc2)
     
     
     -->
      <selectKey order="BEFORE" keyProperty="seq" resultType="String">
       SELECT NVL(MAX(TO_NUMBER(SEQ)),0)+1 FROM NOTICES
      </selectKey>
      INSERT INTO NOTICES(SEQ, TITLE, CONTENT, WRITER, REGDATE, HIT, FILESRC , FILESRC2)
      VALUES( #{seq}, #{title}, #{content}, #{writer}, SYSDATE, 0, #{fileSrc ,jdbcType=VARCHAR} , #{fileSrc2 ,jdbcType=VARCHAR})
     </insert>
	
	

</mapper> 